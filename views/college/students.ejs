<!DOCTYPE html>
<html>
<head>
  <title>College Students</title>
</head>
<body>

<h2>Students</h2>

<table border="1" cellpadding="5">
  <thead>
    <tr>
      <th>Name</th>
      <th>Enrollment</th>
      <th>Blacklisted</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="studentsTable"></tbody>
</table>

<br />
<a href="/college/dashboard">Back</a>

<script>
async function loadStudents() {
  const res = await fetch("/api/colleges/students", {
    credentials: "include"
  });
  const data = await res.json();

  const table = document.getElementById("studentsTable");
  table.innerHTML = "";

  data.students.forEach(student => {
    const tr = document.createElement("tr");

    const isBlacklisted = student.blacklistedBy.length > 0;

    tr.innerHTML = `
      <td>${student.name}</td>
      <td>${student.enrollment_no}</td>
      <td>${isBlacklisted ? "YES" : "NO"}</td>
      <td></td>
    `;

    const btn = document.createElement("button");
    btn.textContent = isBlacklisted ? "Unblacklist" : "Blacklist";

    btn.addEventListener("click", () => {
      isBlacklisted
        ? unBlacklist(student._id)
        : blacklist(student._id);
    });

    tr.children[3].appendChild(btn);
    table.appendChild(tr);
  });
}

  async function blacklist(id) {
    await fetch(`/api/colleges/blacklist/${id}`, {
      method: "POST",
      credentials: "include"
    });
    loadStudents();
  }

  async function unBlacklist(id) {
    await fetch(`/api/colleges/unblacklist/${id}`, {
      method: "POST",
      credentials: "include"
    });
    loadStudents();
  }

  loadStudents();
</script>

</body>
</html>
