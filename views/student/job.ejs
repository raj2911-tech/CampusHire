<!DOCTYPE html>
<html>
<head>
  <title>Job Details</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 30px;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    }

    h2 {
      margin-bottom: 10px;
    }

    .company {
      color: #555;
      font-size: 16px;
      margin-bottom: 15px;
    }

    .row {
      margin-bottom: 8px;
    }

    .tag {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: bold;
    }

    .approved { background: #e8f8f5; color: #27ae60; }

    .btn {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 15px;
    }

    .apply-btn {
      background: #667eea;
      color: white;
    }

    .apply-btn:hover {
      background: #5563d9;
    }

    .back-btn {
      background: #ecf0f1;
      color: #333;
      margin-right: 10px;
    }
  </style>
</head>
<body>

<div class="container" id="jobBox">
  Loading job details...
</div>

<script>
  // Get job ID from URL
  const jobId = window.location.pathname.split("/").pop();

  async function loadJob() {
    try {
      const res = await fetch(`/api/students/jobs/${jobId}`, {
        credentials: "include"
      });

      const data = await res.json();
      if (!data.success) {
        document.getElementById("jobBox").innerText = "Job not found";
        return;
      }

      const job = data.jobs[0]; // your backend sends jobs array

      document.getElementById("jobBox").innerHTML = `
        <h2>${job.title}</h2>
        <div class="company">${job.companyId.name}</div>

        <div class="row"><b>Description:</b> ${job.description}</div>
        <div class="row"><b>Salary:</b> ₹ ${job.salary}</div>
        <div class="row"><b>Deadline:</b> ${new Date(job.deadline).toDateString()}</div>

        <div class="row"><b>Min CGPA:</b> ${job.eligibility.minCGPA}</div>
        <div class="row"><b>Allowed Branches:</b> ${job.eligibility.allowedBranches.join(", ")}</div>
        <div class="row"><b>Graduation Year:</b> ${job.eligibility.graduationYear}</div>

        <div class="row">
          <span class="tag approved">${job.status}</span>
        </div>

        <button class="btn back-btn" onclick="goBack()">← Back</button>
        <button class="btn apply-btn" onclick="applyJob('${job._id}')">Apply Now</button>

        <p id="msg"></p>
      `;
    } catch (err) {
      document.getElementById("jobBox").innerText = "Error loading job";
    }
  }

  function goBack() {
    window.location.href = "/student/jobs";
  }

  // APPLY JOB
  async function applyJob(jobId) {
    const res = await fetch(`/api/students/apply/${jobId}`, {
      method: "POST",
      credentials: "include"
    });

    const data = await res.json();
    document.getElementById("msg").innerText = data.message;
  }

  loadJob();
</script>

</body>
</html>
